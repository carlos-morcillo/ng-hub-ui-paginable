<ng-container *ngIf="!pagination">
	<div class="d-flex justify-content-center">
		<div class="spinner-border m-4" style="width: 3rem; height: 3rem;" role="status">
			<span class="sr-only">Loading...</span>
		</div>
	</div>
</ng-container>

<div class="row justify-content-end">
	<div *ngIf="showSearchInput" class="col-offset col-sm-6 col-md-4">
		<div class="input-group mb-3">
			<input type="text" class="form-control" [(ngModel)]="searchText" placeholder="Search" aria-label="Search"
				(keyup.enter)="filter()">
			<div class="input-group-append">
				<button class="btn btn-secondary" type="button" (click)="filter()">
					<i class="fa fa-search" aria-hidden="true"></i>
				</button>
			</div>
		</div>
	</div>
</div>

<ng-container *ngIf="pagination?.data && !pagination[mapping.data].length"
	[ngTemplateOutlet]="templateNotFound || defaultNotFoundTemplate">
</ng-container>

<ng-container *ngIf="pagination?.data.length">
	<nb-table-sorter-paginator *ngIf="pagination && (paginationPosition == 'top' || paginationPosition === 'both')"
		[pagination]="pagination">
	</nb-table-sorter-paginator>

	<table class="table">
		<thead>
			<tr>
				<th *ngIf="selectable">
					<input type="checkbox" [(ngModel)]="allRowsSelected" (click)="toggleAll()">
				</th>
				<th *ngFor="let item of headers" (click)="sort(item)" class="p-2">
					<ng-container *ngIf="item | isObject">
						<div class="row align-items-center m-0">
							<div class="col-auto p-0">
								<i class="fa fa-{{ item.icon }}" [ngClass]="{'mr-2': item.title}" *ngIf="item.icon"
									aria-hidden="true"></i>
							</div>
							<div class="col p-0">
								<span *ngIf="item.title" class="text-wrap">{{ item.title | ucfirst }}</span>
							</div>
							<div class="col-auto p-0">
								<i class="fa ml-2" *ngIf="item.sortable" [ngClass]="getOrdenationClass(item)"
									aria-hidden="true"></i>
							</div>
						</div>
					</ng-container>
					<ng-container *ngIf="item | isString">
						{{ item | ucfirst }}
					</ng-container>
				</th>
				<th *ngIf="actions?.length || templateExpandingRows.length"></th>
			</tr>
		</thead>

		<tbody>
			<ng-container *ngFor="let item of pagination[mapping.data]; let i=index">
				<ng-container [ngTemplateOutlet]="templateRow || defaultRowTemplate"
					[ngTemplateOutletContext]="{$implicit: item}">
				</ng-container>
			</ng-container>
		</tbody>
	</table>
	<div class="row justify-content-end align-items-center mb-4">
		<div class="form-group form-group-sm row col-auto mb-0 mr-2">
			<label for="RowsPerPageInput" class="col col-form-label text-nowrap"><small>Rows per page:</small></label>
			<div class="col pl-0">
				<select class="form-control form-control-sm" id="RowsPerPageInput" [(ngModel)]="itemsPerPage">
					<option *ngFor="let option of perPageOptions" [value]="option">{{ option }}</option>
				</select>
			</div>
		</div>
		<p class="col-auto mb-0" *ngIf="pagination && paginationInfo">
			<small class="text-muted">Showing {{ pagination[mapping.data].length }} of
				{{ pagination[mapping.total] }}
				rows</small>
		</p>
	</div>

	<nb-table-sorter-paginator (onPageClick)="pageClicked($event)"
		*ngIf="pagination && (paginationPosition == 'bottom' || paginationPosition === 'both')"
		[pagination]="pagination"></nb-table-sorter-paginator>
</ng-container>

<ng-template #defaultRowTemplate let-item>
	<tr (click)="itemClicked(item)" [style.cursor]="options.cursor || 'default'">
		<td *ngIf="selectable">
			<input type="checkbox" [(ngModel)]="item.selected" (click)="toggle(item)">
		</td>
		<td *ngFor="let header of headers">
			<ng-container [ngTemplateOutlet]="getCellTemplate(header) || defaultCellTemplate"
				[ngTemplateOutletContext]="{item: item, property: getProperty(item, header?.property || header)}">
			</ng-container>
		</td>
		<td *ngIf="actions?.length || templateExpandingRows?.length" class="actions">
			<button *ngFor="let action of actions" class="btn btn-link px-2"
				[ngClass]="action.color ? 'text-' + action.color : 'text-dark'" [title]="action.title"
				(click)="handleAction($event, action.handler, item)">
				<i *ngIf="action.icon" [ngClass]="action.icon"></i>
			</button>
			<button *ngIf="templateExpandingRows?.length" (click)="toggleExpandedRow(item)" class="btn btn-link">
				<i class="fa" [ngClass]="item.unfold ? 'fa-sort-asc' : 'fa-sort-desc'"></i>
			</button>
		</td>
	</tr>
	<ng-container *ngIf="item.unfold">
		<ng-container *ngFor="let template of templateExpandingRows">
			<ng-container [ngTemplateOutlet]="template.template" [ngTemplateOutletContext]="{item: item}">
			</ng-container>
		</ng-container>
	</ng-container>
</ng-template>

<ng-template #defaultCellTemplate let-property="property">
	{{ property }}
</ng-template>

<ng-template #defaultNotFoundTemplate>
	<div class="alert alert-warning" role="alert">
		<i class="fa fa-fw fa-info-circle" aria-hidden="true"></i> No se han encontrado resultados
	</div>
</ng-template>