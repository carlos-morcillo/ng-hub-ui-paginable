<ng-container [formGroup]="form">
	<li
		*ngIf="header.filter?.type !== 'boolean'"
		class="dropdown-item filter__operator"
	>
		<select
			class="form-select filter__operator__control"
			formControlName="operator"
			(click)="$event.stopPropagation()"
		>
			<option value="and">{{ 'MATCH_ALL' | translate | ucfirst }}</option>
			<option value="or">{{ 'MATCH_ANY' | translate | ucfirst }}</option>
		</select>
	</li>
	<ng-container formArrayName="rules">
		<ng-container
			*ngFor="
				let group of rulesFA.controls;
				let index = index;
				let last = last
			"
			[formGroupName]="index"
		>
			<li class="dropdown-item filter__rule">
				<div class="d-flex flex-column gap-2 mb-2">
					<select
						class="form-select filter__rule__mode"
						formControlName="matchMode"
					>
						<option [ngValue]="null">
							{{
								header.filter.placeholder ?? 'SELECT_ONE'
									| translate
									| ucfirst
							}}
						</option>
						<option
							*ngFor="let mode of matchModes | keyvalue"
							[value]="mode.key"
						>
							{{
								'MATCH_MODES.' + mode.key
									| uppercase
									| translate
									| ucfirst
							}}
						</option>
					</select>
					<div [ngSwitch]="header.filter?.type">
						<div *ngSwitchCase="'number'">
							<input
								type="number"
								class="form-control filter__rule__value"
								formControlName="value"
							/>
						</div>
						<div *ngSwitchCase="'number-range'">
							<input
								type="number"
								class="form-control filter__rule__value"
								formControlName="value"
							/>
						</div>
						<div *ngSwitchCase="'date'">
							<input
								type="date"
								class="form-control filter__rule__value"
								formControlName="value"
							/>
						</div>
						<div *ngSwitchCase="'date-range'">
							<input
								type="date"
								class="form-control filter__rule__value"
								formControlName="value"
							/>
						</div>
						<div *ngSwitchCase="'boolean'">
							<select
								class="form-select form-control filter__rule__value"
								formControlName="value"
							>
								<option [ngValue]="null">
									{{
										header.filter.placeholder ??
											'SELECT_ONE'
											| translate
											| ucfirst
									}}
								</option>
								<option [ngValue]="true">
									{{
										header.filter.trueLabel ??
											('TRUE' | translate | ucfirst)
									}}
								</option>
								<option [ngValue]="false">
									{{
										header.filter.falseLabel ??
											('FALSE' | translate | ucfirst)
									}}
								</option>
							</select>
						</div>
						<div *ngSwitchDefault>
							<input
								[readOnly]="
									[
										nullMatchModes.IsNull,
										nullMatchModes.IsNotNull
									].includes(group.get('matchMode').value)
								"
								type="text"
								class="form-control filter__rule__value"
								formControlName="value"
							/>
						</div>
					</div>
				</div>
				<div
					*ngIf="rulesFA.controls.length > 1"
					class="d-flex justify-content-end"
				>
					<button
						class="btn btn-sm text-danger text-center w-100"
						(click)="rulesFA.removeAt(index)"
					>
						<i class="fa-solid fa-trash me-2 mr-2"></i
						>{{ 'REMOVE_RULE' | translate | ucfirst }}
					</button>
				</div>
			</li>
			<li
				*ngIf="rulesFA.controls.length > 1"
				class="filter__rule__divider"
			>
				<hr class="dropdown-divider" />
			</li>
		</ng-container>
	</ng-container>
	<li
		class="dropdown-item filter__add-rule"
		*ngIf="header.filter?.type !== 'boolean'"
	>
		<button
			class="btn btn-sm text-primary text-center w-100"
			(click)="add(); $event.stopPropagation()"
		>
			<i class="fa-solid fa-plus me-2 mr-2"></i
			>{{ 'ADD_RULE' | translate | ucfirst }}
		</button>
	</li>
	<li class="dropdown-item filter__actions">
		<div class="d-flex justify-content-between align-items-center gap-3">
			<button
				class="btn btn-outline-danger filter__actions__clear"
				(click)="clear()"
			>
				{{ 'CLEAR' | translate | ucfirst }}
			</button>
			<button
				class="btn btn-primary filter__actions__apply"
				(click)="apply()"
			>
				{{ 'APPLY' | translate | ucfirst }}
			</button>
		</div>
	</li>
</ng-container>
